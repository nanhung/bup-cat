---
title: "Supplemental Material"
subtitle: '**A Bayesian Population Physiologically Based Pharmacokinetic Absorption Modeling Approach to Support Generic Drug Development: Application to Bupropion Hydrochloride Oral Dosage Forms**'
author: "Nan-Hung Hsieh$^{1,**}$, Frédéric Y. Bois$^{2,**}$, Eleftheria Tsakalozou$^3$, Zhanglin Ni$^3$, Miyoung Yoon$^3$,  \nWanjie Sun$^4$, Martin Klein$^4$, Brad Reisfeld$^5$, Weihsueh A. Chiu$^{1,*}$"
header-includes:
    - \usepackage{longtable}
    - \usepackage{caption}
    - \usepackage{booktabs}
    - \usepackage{threeparttablex}
    - \captionsetup[figure]{labelformat=empty}
    - \captionsetup[table]{labelformat=empty}
    - \usepackage{lscape}
    - \newcommand{\blandscape}{\begin{landscape}}
    - \newcommand{\elandscape}{\end{landscape}}
bibliography: references.bib
linestretch: 2
numbersections: true

output:
  pdf_document:
    keep_tex: true
    citation_package: natbib
    #latex_engine: xelatex
    #latex_engine: pdflatex
    toc: true
    toc_depth: 3
    fig_caption: true

---

```{r export, eval=F, echo=F}
rmarkdown::render("supplementary.Rmd")
```

```{r package, echo = F, eval= T, include=F}
pkg <- c("pksensi", 
         "data.table", 
         "rstan", 
         "tidyverse",
         "bayesplot",
         "GGally", 
         "ggpubr",
         "scales", 
         "cowplot", 
         "magrittr",
         "LaplacesDemon", 
         "bayestestR", 
         "PowerTOST",
         "foreach",
         "doParallel",
         "kableExtra",
         "pksensi", 
         "PKNCA",
         "tinytex",
         "rmarkdown")
for (i in 1:length(pkg)) {
  tmp <- require(pkg[i], character.only = TRUE)
  if (!tmp) install.packages(pkg[i])
  library(pkg[i], character.only = TRUE)
}
```

```{r setup, include=F}
knitr::opts_chunk$set(warning = F, echo = F, message = F, eval = T, comment = NA, background = c(0, 0, 0))
```

\newpage

\listoftables
\listoffigures

\newpage

Supplementary Data
==================

The supplementary data include R code (**codes**) and datasets (**datasets**) that can reproduce the modeling and analyze result (in **outputs** folder) and visualize plots (in **plots** folder). All data will publicly release on GitLab after the paper published. The details and data pipelines are included in:

- **codes:** The R source code to reproduce the modeling and analyze result.

- **datasets:** The provided tidy data files.

- **MCSim:** The source fils of GNU MCSim software and the related modeling files that can conduct MCMC simulation and prediction.

- **outputs**: The files in the output folder are generated by the above R code and datasets.

- **plots:** All plots showed in the manuscript were saved with *fig{number}.jpeg* with solution of 300 dpi. The **suppl**  folder includes the supplementary figures that showed below.

\newpage

Physiologically Based Pharmacokinetic Absorption Model
======================================================

## Main differential equations

Two-compartment model was used to describe the quantity of drug in the central (plasma; $Q_{central}$) and peripheral (others tissues; $Q_{periph}$) compartments as:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{central}}{\partial t} = & (F_{portal}+F_{liver}) \cdot C_{blood,liver} - (F_{portal}+F_{liver}) \cdot C_{blood} \\
& + \frac{V_{max,eff_{liver}} \cdot C_{u_{blood,liver}}} {K_{m,eff} + C_{u_{blood,liver}}} - \frac{V_{max,inf_{liver}} \cdot C_{u_{blood,liver}}}{K_{m,inf} + C_{u_{blood,liver}}} \\ 
& - K_{c2p} \cdot Q_{central} - K_{p2c} \cdot Q_{periph} - K_{elim} * Q_{central}
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
\frac{\partial Q_{periph}}{\partial t} =  K_{p2c} \cdot Q_{periph} - K_{c2p} \cdot Q_{central} 
\end{aligned}
\end{equation}

where $F_{portal}$ and $F_{liver}$ are the portal blood flow and direct arterial flow to the liver, respectively; $C_{blood}$ is the input (arterial) blood drug concentration; $C_{blood,liver}$ is the blood concentration at the liver exit; $V_{max,inf_{liver}}$ is the Michaelis-Menten maximum rate of active drug transport from blood into liver tissue; $C_{u_{blood,liver}}$ is the concentration of unbound drug in blood at the liver exit; $K_{m,inf}$ is the Michaelis-Menten constant for active transport into tissues (influx) (assumed to be the same for all tissues); $V_{max,eff_{liver}}$ is the Michaelis-Menten maximum rate of active drug transport from liver tissue to blood; $C_{u_{liver}}$ is the concentration of unbound drug in liver tissue;  $K_{m,eff}$ is the Michaelis-Menten constant for active transport out of tissues (efflux) (assumed to be the same for all tissues); $K_{c2p}$ and $K_{p2c}$ are the rate constants that control the exchange rate between central and peripheral compartments. $K_{elim}$ is the elimniation rate of central compartment. 

$C_{blood,liver}$  is given by:

\begin{equation}
\begin{aligned}
C_{blood,liver} = \frac{C_{u_{blood,liver}}}{f_{u_{blood}}}
\end{aligned}
\end{equation}

where  $f_{u_{blood}}$ is the fraction of drug unbound in blood (computed as $f_{u_{plasma}}$, fraction unbound in blood plasma, divided by the blood over plasma concentration ratio $r_{BP}$).

$C_{u_{blood,liver}}$  is given by:

\begin{equation}
\begin{aligned}
C_{u_{blood,liver}} = \frac{C_{u_{liver}}}{K_{puu_{liver}}}
\end{aligned}
\end{equation}

where $K_{puu_{liver}}$ is the equilibrium ratio (partition coefficient) of unbound drug concentration in liver over unbound concentration in blood.

$C_{u_{liver}}$ is given by:

\begin{equation}
\begin{aligned}
C_{u_{liver}} = f_{u_{liver}} \cdot C_{liver}
\end{aligned}
\end{equation}

where $f_{u_{liver}}$ is the fraction of drug unbound in liver tissue, and $C_{liver}$ is the total liver concentration ($Q_{liver}$ divided by $V_{{liver}}$).

Note that the apparent liver over blood partition coefficient, $PC_{liver}$, is given by:

\begin{equation}
\begin{aligned}
PC_{liver} = \frac{K_{puu_{liver}} \cdot f_{u_{blood}}}{f_{u_{liver}}}
\end{aligned}
\end{equation}

Addition, the plasma concentration can further compute with volume of central compartment ($V_{central}$) and body weight ($BW$) as 
\begin{equation}
\begin{aligned}
C_{central} = \frac{Q_{central}}{V_{central} \cdot BW}
\end{aligned}
\end{equation}

The differential equation for the quantity of drug in the liver is the sum of terms for blood transport, active transporter influx from blood, active transporter efflux from liver tissue and metabolism:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{liver}}{\partial t} = & R_{in} + F_{liver}\cdot C_{blood} - (F_{portal}+F_{liver}) \cdot C_{blood, liver} \\
& + \frac{V_{max,inf_{liver}} \cdot C_{u_{blood,liver}}}{K_{m,inf} + C_{u_{blood,liver}}} - \frac{V_{max,eff_{liver}} \cdot C_{u_{blood,liver}}}{K_{m,eff} + C_{u_{blood,liver}}} \\
& - \frac{V_{max,met_{liver}} \cdot C_{u_{liver}}}{K_{m,met} \cdot f_{u_{liver,vitro}} + C_{u_{liver}}}
\end{aligned}
\end{equation}

where $R_{in}$, whose formula is given below, is the rate of input from the gut walls via the portal blood flow ($F_{portal}$); $V_{max,met_{liver}}$ is the Michaelis-Menten maximum rate of metabolism in liver; $K_{m,met}$ is the Michaelis-Menten constant for metabolism (assumed to be the same for all tissues); and  $f_{u_{liver,vitro}}$ is the fraction of drug unbound in the in vitro system used to estimate liver metabolism and available for metabolism.

$R_{in}$ is given by:

\begin{equation}
\begin{aligned}
R_{in} = \sum_{i \in O} F_{i} \cdot C_{blood,wall_{i}}
\end{aligned}
\end{equation}

where the summation is taken over the set $O$ of gut segments ($O$ = {stomach, duodenum, jejunum, ileum, cecum, colon}), $F_{i}$ is the blood flow perfusing segment $i$, $C_{blood,wall_{i}}$ is the drug blood concentration at the exit of segment $i$ wall. Note that the sum of the flows $F_i$ is equal to $F_{portal}$.

Similarly to liver, $C_{blood,wall_{i}}$ is given by:

\begin{equation}
\begin{aligned}
C_{blood,wall_{i}} = \frac{C_{u_{blood,wall_{i}}}}{f_{u_{blood}}}
\end{aligned}
\end{equation}

$C_{u_{blood,wall_{i}}}$ is given by:

\begin{equation}
\begin{aligned}
C_{u_{blood,wall_{i}}} = \frac{C_{u_{wall_{i}}}}{K_{puu_{i}}}
\end{aligned}
\end{equation}

where $K_{puu_{i}}$ is the equilibrium ratio (partition coefficient) of unbound drug concentration in segment $i$ wall over unbound concentration in blood.

$C_{u_{wall_{i}}}$  is given by:

\begin{equation}
\begin{aligned}
C_{u_{wall_{i}}} = f_{u_{i}} \cdot C_{wall_{i}}
\end{aligned}
\end{equation}


where $f_{u_{i}}$ is the fraction of drug unbound in segment $i$ tissues (same value assumed for wall and epithelium), and $C_{wall_{i}}$ is the total segment $i$ wall drug concentration ($Q_{wall_{i}}$  divided by $V_{wall_{i}}$).

The differential equations governing drug quantity in gut walls for the various segments are:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{wall_{i}}}{\partial t} = F_{i}(C_{input}-C_{blood,wall_{i}}) + K_{a_{i}}(C_{u_{epith_{i}}}-K_{E/At} \cdot C_{u_{wall_{i}}})
\end{aligned}
\end{equation}

where $C_{input}$ is the (arterial) blood concentration in input of segment $i$, $K_{a_{i}}$ is the absorption flow in segment $i$, $C_{u_{epith_{i}}}$ is the free drug concentration in the epithelium of segment $i$, and $K_{E/At}$ is the wall to epithelium excretion over absorption ratio.

$C_{u_{epith_{i}}}$ is given by:

\begin{equation}
\begin{aligned}
C_{u_{epith_{i}}} = f_{u_{i}} \cdot C_{epith_{i}}
\end{aligned}
\end{equation}

where $C_{u_{epith_{i}}}$ is the total segment $i$ epithelium drug concentration ($Q_{epith_{i}}$ divided by $V_{epith_{i}}$).

For the drug quantities in epithelia, $Q_{epith_{i}}$, the differential equations are:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{epith_{i}}}{\partial t} = & K_{a_{i}}(C_{diss}-K_{E/Ae} \cdot C_{u_{epith_{i}}}) - K_{a_{i}}(C_{u_{epith_{i}}}-K_{E/At} \cdot C_{u_{wall_{i}}}) \\
& + \frac{V_{max,inf_{i}} \cdot C_{diss_{i}}}{K_{m,inf} + C_{diss_{i}}} - \frac{V_{max,eff_{i}} \cdot C_{u_{epith_{i}}}}{K_{m,eff} + C_{u_{epith_{i}}}} \\
& - \frac{V_{max,met_{i}} \cdot C_{u_{epith_{i}}}}{K_{m,met} \cdot f_{u_{i,vitro}} + C_{u_{epith_{i}}}}
\end{aligned}
\end{equation}

where $C_{diss_{i}}$ is the dissolved drug concentration in the lumen of segment $i$; $K_{E/Ae}$ is the epithelium to lumen excretion over absorption ratio in $i$; $V_{max,inf_{i}}$ is the Michaelis-Menten maximum rate of active drug transport from lumen into epithelium in segment $i$; $K_{m,inf}$ is the Michaelis-Menten constant for active transport into tissues (influx) (assumed to be the same for all tissues); $V_{max,eff_{i}}$ is the Michaelis-Menten maximum rate of active drug transport from epithelium tissue to lumen in segment $i$; $K_{m,eff}$ is the Michaelis-Menten constant for active transport out of tissues (efflux) (assumed to be the same for all tissues); $V_{max,met_{i}}$ is the Michaelis-Menten maximum rate of metabolism in epithelium $i$; $K_{m,met}$ is the Michaelis-Menten constant for metabolism (assumed to be the same for all tissues); and $f_{u_{i,vitro}}$ is the fraction of drug unbound in the in vitro system used to estimate epithelium $i$ metabolic parameters.

## Drug dissolution equations

For the dissolved drug quantities in lumina, $Q_{diss_{i}}$, the differential equations are:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{diss_{i}}}{\partial t} = & R_X - K_{t} \cdot C_{diss_{i}} - K_{a_{i}} (C_{diss_{i}} - K_{E/Ae} \cdot C_{u_{epith_{i}}}) \\ 
& + K_{diss_{i}}(t) \cdot Q_{undiss_{i}} - K_{precip} \cdot Q_{diss_{i}} \\
& + \frac{V_{max,eff_{i}} \cdot C_{u_{epith_{i}}}}{K_{m,eff} + C_{u_{epith_{i}}}} - \frac{V_{max,inf_{i}} \cdot C_{diss_{i}}}{K_{m,inf} + C_{diss_{i}}}
\end{aligned}
\end{equation}

where $R_{X}$ is the dissolved drug release rate in the stomach (see below), for the other gut segments $R_{X}$  is zero; $K_{t_{i}}$ is the intestinal transit rate in $i$; $K_{diss_{i}}(t)$ is the instantaneous drug dissolution rate in $i$ (see next paragraph), and $K_{precip}$ is the drug precipitation rate constant (assumed to be same in all gut segments).

The instantaneous dissolution rate constants, $K_{diss_{i}}(t)$ in 1/hours, are computed at any time as:

\begin{equation}
\begin{aligned}
K_{diss_{i}}(t) = K_{diss}(C_{sat_i}-C_{diss_i})
\end{aligned}
\end{equation}

where $K_{diss}$ is the drug baseline dissolution rate constant (in 1/microM/hours), and $C_{sat_{i}}$ is the saturation concentration in segment $i$ (see below).

For the undissolved drug quantities in lumina, $Q_{undiss_{i}}$, the differential equations are:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{undiss_{i}}}{\partial t} = R'_X - K_{t} \cdot C_{undiss_{i}} -  K_{diss_{i}}(t) \cdot Q_{undiss_{i}} + K_{precip} \cdot Q_{diss}
\end{aligned}
\end{equation}

In the stomach, $R'X$ is the undissolved drug release rate (see below). For the other g.i. tract segments, $R'X$ is zero.
The dissolved and undissolved drug quantities excreted in the feces are given by:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{diss_{feces}}}{\partial t} = K_{t_{colon}} \cdot C_{diss_{colon}}
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
\frac{\partial Q_{undiss_{feces}}}{\partial t} = K_{t_{colon}} \cdot C_{undiss_{colon}}
\end{aligned}
\end{equation}

## Drug release models

Drug release in the stomach can take various forms. First, the drug can be released in a dissolved or undissolved form (which may then equilibrate according to equations 13 and 15). Next, the release can be immediate or delayed.

**Immediate release:** The rate $R_{X}$ (dissolved) or $R'_{X}$ (undissolved) is equal to the oral administration rate $D_{rate}$ (a model input, in $\mu \textrm{M}$ / hours). A bolus administration can be simulated by giving $D_{rate}$ a high value for a short time, or by setting it to zero and setting the initial value of the state variable $Q_{diss_{stomach}}$ to the bolus dose prescribed.

**Delayed release:**

The delayed release form was set to Weibull-based function for release rate constant ($K_{release}$), which is given by: 

\begin{equation}
\begin{aligned}
K_{release} = \frac{k}{\lambda} \left( \frac{t}{\lambda} \right) ^{k-1}
\end{aligned}
\end{equation}

where $k$ is Weibull slope and $\lambda$ is Weibull scale. When $k$ = 1, the $K_{release}$ will be a constant and follow the first-order release. Also, in that case, we would have:

\begin{equation}
\begin{aligned}
Rx = K_{release} \cdot Q_{remain} 
\end{aligned}
\end{equation}

which would require the following differential equation for the quantity $Q_{remain}$ remaining to be released to the stomach at time $t$:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{remain}}{\partial t} = D_{rate} - R_{x}
\end{aligned}
\end{equation}


## Miscellaneous equations

Miscellaneous equations are used to compute various quantities of eventual interest. The quantities absorbed in each gut segment are computed by integration of the following differential:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{abs_{i}}}{\partial t} = K_{a_{i}}(C_{diss_{i}}-K_{E/Ae}\cdot C_{u_{epith_{i}}}) + \frac{V_{max,inf_{i}} \cdot C_{diss_{i}}}{K_{m,inf}+C_{diss_{i}}} - \frac{V_{max,eff_{i}} \cdot C_{u_{epith_{i}}}}{K_{m,eff}+C_{u_{epith_{i}}}}
\end{aligned}
\end{equation}

The quantity metabolized in each gut segment is computed by integration of the following differential:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{met_{i}}}{\partial t} = \frac{V_{max,met_{i}} \cdot C_{u_{epith_{i}}}}{K_{m,met} \cdot f_{u_{i,vitro}} + C_{u_{epith_{i}}}} 
\end{aligned}
\end{equation}


The quantity reaching the portal vein at time t ($Q_{abs_{portal}}$) has the following differential:

\begin{equation}
\begin{aligned}
\frac{\partial Q_{abs_{portal}}}{\partial t} = R_{in} 
\end{aligned}
\end{equation}

see equation 6 for the definition of $R_{in}$.

The instantaneous apparent rate of gut absorption is:

\begin{equation}
\begin{aligned}
K_{a} = \frac{Q_{abs_{portal}}}{\sum_{i \in O}Q_{diss_{i}}}
\end{aligned}
\end{equation}

The major mass balance checking equations are:

\begin{equation}
\begin{aligned}
Q_{diss} = \sum_{i \in O}Q_{diss_{i}}
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
Q_{epith} = \sum_{i \in O}Q_{epith_{i}}
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
Q_{wall} = \sum_{i \in O}Q_{wall_{i}}
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
Q_{abs} = \sum_{i \in O}Q_{abs_{i}}
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
Q_{elim_{gut}} = \sum_{i \in O} Q_{met_{i}} + Q_{diss_{feces}} + Q_{undiss_{feces}}
\end{aligned}
\end{equation}

Finally, epithelial permeability in gut segment $i$ is given by: 

\begin{equation}
\begin{aligned}
K_{a_i} = P_{eff} \cdot SA_i       
\end{aligned}
\end{equation}

where $P_{eff}$ is the effective permeability of gut epithelia, and $SA_i$ the epithelial surface area of $i$ (calculated from the lengths and radii).


\newpage

Supplementary Tables
====================

```{r}
parameters <- "datasets/parameters_phys.csv"
read.csv(parameters) %>% 
  kable(booktabs = T, longtable = T, 
        caption = "Table S1. Summary of distributions of the physiologically-specific parameters.",
        format = 'latex', escape = FALSE, 
        align='llcccc') %>% 
  kable_styling(latex_options = c("repeat_header"), font_size = 8)
```

\newpage

```{r}
parameters <- "datasets/parameters_drug.csv"
read.csv(parameters) %>% 
  kable(booktabs = T, longtable = T, 
        caption = "Table S2. Summary of distributions of the drug-specific parameters for bupropion hydrochloride.",
        format = 'latex', escape = FALSE, 
        align='lllccc') %>% 
  kable_styling(latex_options = c("repeat_header"), font_size = 8) %>% landscape()
```

\newpage

```{r}
mcmc_report <- "outputs/mcmc_report_1.csv"
read.csv(mcmc_report) %>% 
  kable(booktabs = T, longtable = T, 
        caption = "Table S3. Summary of stage I Weibull parameters posteriors, calibrated by MCMC simulations.",
        format = 'latex', align='lrrrrrr') %>%
  kable_styling(latex_options = c("repeat_header"), font_size = 8)
```

\newpage

```{r}
parameters <- "datasets/stageIIparms.csv"
read.csv(parameters) %>% 
  kable(booktabs = T, longtable = T, 
        caption = "Table S4. Stage II prior parameter distributions used.",
        format = 'latex', escape = FALSE, 
        align='llccccl') %>% 
  kable_styling(latex_options = c("repeat_header"), font_size = 8)
```

\newpage

```{r}
mcmc_report <- "outputs/mcmc_report_2.csv"
read.csv(mcmc_report) %>% 
  kable(booktabs = T, longtable = T, 
        caption = "Table S5. Summary of stage II parameters posteriors, calibrated by MCMC simulations.",
        format = 'latex', align='lrrrrrr') %>%
  kable_styling(latex_options = c("repeat_header"), font_size = 8)
```

\newpage

```{r}
readRDS(file = "outputs/pk_parameters.rds") %>%
  kbl(booktabs = T, align = "c", linesep = '',
      caption = "Table S6. Comparison of PK parameters from calibration, validation and simulation groups.") %>%
  kable_paper(full_width = F) %>%
  pack_rows("IR 75", 1, 3) %>%
  pack_rows("IR 100", 4, 6) %>%
  pack_rows("SR 100", 7, 9) %>%
  pack_rows("SR 150", 10, 12) %>%
  pack_rows("ER 150", 13, 15) %>%
  pack_rows("ER 300", 16, 18) %>%
  footnote(general = "The Cmax and AUC are represented by geometric mean and geometric coefficient of variation. The Tmax is represented by median and range",
           threeparttable = T)
```

\clearpage
\newpage

Supplementary Figures
======================

\begin{figure}
\includegraphics[width=\textwidth]{plots/suppl/population_mean_posterior.pdf}\caption{Figure S1. Marginal posterior distributions of the population mean from each simulation.}\label{fig:s1}
\end{figure}

\clearpage

\begin{figure}
\includegraphics[width=\textwidth]{plots/suppl/population_vr_posterior.pdf}\caption{Figure S2. Marginal posterior distributions of the population inter-variance from each simulation.}\label{fig:s2}
\end{figure}

\clearpage

\begin{figure}
\includegraphics[width=\textwidth]{plots/suppl/population_va_posterior.pdf}\caption{Figure S3. Marginal posterior distributions of the population intra-variance from each simulation.}\label{fig:s3}
\end{figure}

\clearpage

\begin{figure}
\includegraphics[width=\textwidth]{plots/suppl/calibration_individuals.pdf}\caption{Figure S4. Posterior fits of the inter- and intra-individual variability data on plasma concentration in 15 subjects.}\label{fig:s4}
\end{figure}

\clearpage

\begin{figure}
\includegraphics[width=\textwidth]{plots/suppl/correlation_matrix.pdf}\caption{Figure S5. The correlation matrix between posterior parameter values.}\label{fig:s5}
\end{figure}

\clearpage
\newpage

Session Information {.unnumbered}
==================================

```{r}
sessionInfo()
```

\newpage

References {.unnumbered}
========================
